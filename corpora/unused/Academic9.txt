We propose a new gradient-domain technique for processing registered EM image stacks to remove inter-image discontinuities while preserving intra-image detail. To this end, we process the image stack by first performing anisotropic smoothing along the slice axis and then solving a Poisson equation within each slice to re-introduce the detail. The final image stack is continuous across the slice axis and maintains sharp details within each slice. Adapting existing out-of-core techniques for solving the linear system, we describe a parallel algorithm with time complexity that is linear in the size of the data and space complexity that is sub-linear, allowing us to process datasets as large as five teravoxels with a 600 MB memory footprint. Index Terms—Gradient Domain, Image Processing, Image Fusion I. INTRODUCTION Recent innovation and automation of electron microscopy sectioning has made it possible to obtain high-resolution image stacks capturing the relationships between cellular structures [1]. This, in turn, has motivated research in areas such as connectomics [2], [3], [4], [5] which aims to gain insight into neural function through the study of the connectivity network. While the technological advances in acquisition and registration have made it possible to acquire unprecedentedly large micron-resolution volumes, the acquisition process itself introduces undesirable artifacts in the data, complicating tasks of (semi-)automatic anatomy tracking. Specifically, since the individual slices in the stack are imaged independently, discontinuities often arise between successive slices due to variations in lighting, camera parameters, and the physical manner in which a slice is positioned on the slide. An example of these artifacts can be seen in Figure 1 (top-left), which shows an image of the same column taken from successive images in a stack (1850 images at a resolution of 21,504 × 26,624) imaging a mouse cortex [6]. The visualization highlights the local discontinuities (thin vertical stripes across the image) that can arise due to the acquisition process. In this work we propose a new gradient-domain technique for processing these anatomical volumes to remove the undesired artifacts. The processing consists of two phases. In the first phase, we perform anisotropic smoothing across the slice axis to smooth out the discontinuities between these slices. As Figure 1 (center) shows, this has the desirable M. Kazhdan, K. Lillaney, W. Roncal, and R. Burns are with the Department of Computer Science, Johns Hopkins University. D. Bock is with Janelia Farms, Howard Hughes Medical Institute. J. Vogelstein is with the Institute for Computational Medicine, Johns Hopkins University. Fig. 1. Cross-sections of an EM stack showing zy-slices through the data (top) and xy-slices through the data (bottom). The image on the left is taken from the original data, the image in the center is the result of the initial anisotropic smoothing step, and the image on the right is the subsequent solution of the screened-Poisson equation. effect of removing the discontinuities (top) but it also smooths out the anatomical features within the slice (bottom). To address this, we perform a second step of gradient-domain processing on each slice independently, solving a screenedPoisson equation to generate a new voxel grid with lowfrequency content taken from the anisotropically smoothed grid and high-frequency content taken from the original data. As Figure 1 (right) shows, this combines the best parts of both datasets – like the anisotropically smoothed grid, this solution does not exhibit discontinuities between slices (top), while simultaneously preserving the sharp detail present in the original data (bottom). Our implementation of the gradient-domain processing is enabled by adapting an existing, out-of-core Poisson solver [7] to support the frequency-based merging of two images. As a result, our implementation is parallelizable, has linear time complexity, and sub-linear space complexity, supporting the efficient processing of truly large datasets. II. RELATED WORK Over the last decade, gradient-domain approaches have gained prevalence in image processing [8]. Examples include removal of light and shadow effects [9], [10], reduction of dynamic range [11], [12], creation of intrinsic images [13], image stitching [14], [15], [16], removal of reflections [17], and gradient-based sharpening [18]. arXiv:1506.02079v1 [cs.GR] 5 Jun 2015 GRADIENT-DOMAIN FUSION FOR COLOR CORRECTION IN LARGE EM IMAGE STACKS 2 The versatility of gradient-domain processing has led to the design of numerous methods for solving the underlying Poisson problem in the context of large 2D images, including adaptive [19], and hierarchical [20], [21] solvers.